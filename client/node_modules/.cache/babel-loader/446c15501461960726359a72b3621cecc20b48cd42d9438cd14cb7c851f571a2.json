{"ast":null,"code":"import React,{useContext,useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import{toast}from'react-toastify';import{LoginContext}from'../../context/LoginState';import\"../styles/CreatePost.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";let base_uri=process.env.REACT_APP_BASE_URL;export default function CreatePost(){const[body,setBody]=useState(\"\");const[image,setImage]=useState(\"\");const[url,setUrl]=useState(\"\");const navigate=useNavigate();var picLink=\"https://cdn-icons-png.flaticon.com/512/3177/3177440.png\";const{loggedUser}=useContext(LoginContext);//Toast functions\nconst notifyA=data=>toast.success(data);const notifyB=data=>toast.error(data);//useEffect\nuseEffect(()=>{//saving post to mongodb\nif(url){fetch(\"\".concat(base_uri,\"/createPost\"),{method:\"post\",headers:{\"Content-Type\":\"application/json\",\"Authorization\":\"Bearer \"+localStorage.getItem(\"jwt\")},body:JSON.stringify({body,pic:url})}).then(res=>res.json()).then(data=>{if(data.error){notifyB(data.error);}else{notifyA(\"Successfully Posted\");navigate('/');}}).catch(err=>console.log(err));}},[url]);//this useEffect is triggered --> 1. at the loading of the page 2. wheneever the dependecies changes // here \n//useEffect is triggered when 'url' state variable changes\n//posting image to cloudinary\nconst postDetails=()=>{console.log(body,image);const data=new FormData();data.append(\"file\",image);data.append(\"upload_preset\",\"instagram\");data.append(\"cloud_name\",\"vishalranjan\");fetch(\"https://api.cloudinary.com/v1_1/vishalranjan/image/upload\",{method:\"post\",body:data}).then(res=>res.json()).then(data=>setUrl(data.url)).catch(err=>console.log(err));};const loadfile=event=>{const output=document.getElementById('output');output.src=URL.createObjectURL(event.target.files[0]);//this line is responsible for the image displayed in preview;\noutput.onload=function(){URL.revokeObjectURL(output.src);//free memory\n};};return/*#__PURE__*/_jsxs(\"div\",{className:\"createPost\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"post-header\",children:[/*#__PURE__*/_jsx(\"h4\",{style:{margin:\"3px auto\"},children:\"Create New Post\"}),/*#__PURE__*/_jsx(\"button\",{id:\"post-btn\",onClick:()=>{postDetails();},children:\"Share\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"main-div\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"https://cdn-icons-png.flaticon.com/512/1160/1160358.png\",alt:\"\",id:\"output\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/*\",onChange:event=>{loadfile(event);setImage(event.target.files[0]);}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"details\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-pic\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"card-img\",src:loggedUser.Photo?loggedUser.Photo:picLink,alt:\"\"}),/*#__PURE__*/_jsx(\"h5\",{children:JSON.parse(localStorage.getItem(\"user\")).name})]})}),/*#__PURE__*/_jsx(\"textarea\",{type:\"text\",placeholder:\"Write a caption\",value:body,onChange:e=>{setBody(e.target.value);}})]})]});}","map":{"version":3,"names":["React","useContext","useEffect","useState","useNavigate","toast","LoginContext","jsx","_jsx","jsxs","_jsxs","base_uri","process","env","REACT_APP_BASE_URL","CreatePost","body","setBody","image","setImage","url","setUrl","navigate","picLink","loggedUser","notifyA","data","success","notifyB","error","fetch","concat","method","headers","localStorage","getItem","JSON","stringify","pic","then","res","json","catch","err","console","log","postDetails","FormData","append","loadfile","event","output","document","getElementById","src","URL","createObjectURL","target","files","onload","revokeObjectURL","className","children","style","margin","id","onClick","alt","type","accept","onChange","Photo","parse","name","placeholder","value","e"],"sources":["C:/insta/demo/MERN-Instagram-clone-main/client/src/components/screens/CreatePost.js"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react'\nimport { useNavigate } from 'react-router-dom'\nimport { toast } from 'react-toastify'\nimport { LoginContext } from '../../context/LoginState'\nimport \"../styles/CreatePost.css\"\nlet base_uri = process.env.REACT_APP_BASE_URL;\n\nexport default function CreatePost() {\n\n    const [body, setBody] = useState(\"\")\n    const [image, setImage] = useState(\"\")\n    const [url, setUrl] = useState(\"\")\n    const navigate = useNavigate()\n    var picLink = \"https://cdn-icons-png.flaticon.com/512/3177/3177440.png\"\n\n    const {loggedUser} = useContext(LoginContext)\n\n    //Toast functions\n    const notifyA = (data)=> toast.success(data)\n    const notifyB = (data)=> toast.error(data)\n    \n    //useEffect\n    useEffect(()=>{\n        //saving post to mongodb\n        if(url){\n            fetch(`${base_uri}/createPost`, {\n                method: \"post\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"Authorization\": \"Bearer \"+ localStorage.getItem(\"jwt\")\n                },\n                body: JSON.stringify({\n                    body, pic:url\n                })\n            }).then(res => res.json())\n            .then((data)=>{\n                if(data.error){\n                    notifyB(data.error)\n                }else{\n                    notifyA(\"Successfully Posted\")\n                    navigate('/')\n                }\n            })\n            .catch(err=> console.log(err))\n        }\n    }, [url])   //this useEffect is triggered --> 1. at the loading of the page 2. wheneever the dependecies changes // here \n    //useEffect is triggered when 'url' state variable changes\n\n    //posting image to cloudinary\n    const postDetails =()=>{\n        console.log(body, image);\n        const data = new FormData()\n        data.append(\"file\", image)\n        data.append(\"upload_preset\", \"instagram\")\n        data.append(\"cloud_name\", \"vishalranjan\")\n\n        fetch(\"https://api.cloudinary.com/v1_1/vishalranjan/image/upload\", {\n            method: \"post\",\n            body: data\n        }).then(res => res.json())\n        .then(data => setUrl(data.url))\n        .catch(err => console.log(err))\n    }\n\n    const loadfile = (event)=>{\n        const output = document.getElementById('output');\n        output.src = URL.createObjectURL(event.target.files[0]);  //this line is responsible for the image displayed in preview;\n        output.onload = function(){\n            URL.revokeObjectURL(output.src)  //free memory\n        }\n    }\n\n\n  return (\n    <div className='createPost' >\n\n        {/* header */}\n        <div className=\"post-header\">\n            <h4 style={{margin: \"3px auto\"}} >Create New Post</h4>\n            <button id='post-btn' onClick={()=>{postDetails()}} >Share</button>\n        </div>\n\n        {/* image preview */}\n        <div className=\"main-div\">\n            <img src=\"https://cdn-icons-png.flaticon.com/512/1160/1160358.png\" alt=\"\" id='output' />\n            <input type=\"file\" accept='image/*'\n            onChange={(event)=>{\n                loadfile(event)\n                setImage(event.target.files[0])\n            }}\n             />\n        </div>\n\n        {/* details */}\n            <div className=\"details\">\n                <div className=\"card-header\">\n                    <div className=\"card-pic\">\n                        <img className='card-img' src={loggedUser.Photo ? loggedUser.Photo: picLink} alt=\"\" />\n                    <h5>{JSON.parse(localStorage.getItem(\"user\")).name}</h5>\n                    </div>\n                </div>\n                <textarea type=\"text\" placeholder='Write a caption' value={body} onChange={(e)=>{setBody(e.target.value)}} ></textarea>\n            </div>\n\n    </div>\n  )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}